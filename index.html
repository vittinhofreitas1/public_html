<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Easy Flap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; touch-action: manipulation; }
        .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,0.4); }
        canvas { background-color: #87CEEB; display: block; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 12px; }
        .emergency-button:active { transform: scale(0.95); box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0.5); }
        .secure-feature-screen { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 200; }
        .gemini-modal-content { background-color: #1f2937; color: white; margin: 20% auto; padding: 24px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Tela do Jogo (Disfarce) -->
    <div id="game-screen" class="min-h-screen bg-cyan-600 flex flex-col items-center justify-center p-4 overflow-hidden">
        <div class="w-full max-w-sm mx-auto flex justify-between items-center mb-2 z-10">
            <h2 class="text-3xl font-bold text-white text-shadow">Pontos: <span id="score">0</span></h2>
            <button id="settings-button" class="p-2 bg-white/70 rounded-full shadow hover:bg-white transition">
                <svg xmlns="http://www.w.org/2000/svg" class="h-6 w-6 text-cyan-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
            </button>
        </div>
        <canvas id="game-canvas" width="320" height="480"></canvas>
        <p id="start-message" class="text-white font-bold mt-4 z-10 text-shadow">Toque na tela para começar</p>
    </div>

    <!-- Modal de Configurações (Gatilho Secreto) -->
    <div id="settings-modal" class="modal">
        <div class="modal-content bg-cyan-50">
            <h2 class="text-2xl font-bold text-center mb-6 text-cyan-800">Configurações</h2>
            <div class="mb-4">
                <label for="player-name" class="block text-cyan-700 text-sm font-bold mb-2">Nome do Jogador:</label>
                <input type="text" id="player-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="Digite seu nome ou código">
                <p id="error-message" class="text-red-500 text-xs italic mt-2 hidden">Código incorreto.</p>
            </div>
            <div class="flex items-center justify-between">
                <button id="close-modal-button" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition">Fechar</button>
                <button id="save-settings-button" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition">Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Respostas do Gemini -->
    <div id="gemini-modal" class="modal">
        <div class="gemini-modal-content">
            <h3 id="gemini-modal-title" class="text-xl font-bold text-purple-300 mb-4"></h3>
            <div id="gemini-modal-body" class="text-purple-100 whitespace-pre-wrap"></div>
             <button id="close-gemini-modal" class="mt-6 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition">Fechar</button>
        </div>
    </div>


    <!-- Tela Segura (Acesso após senha) -->
    <div id="secure-screen" class="hidden min-h-screen bg-gray-800 text-white p-4 relative">
        <div id="secure-main-menu" class="max-w-md mx-auto">
            <div class="text-center my-6"><h1 class="text-2xl font-bold text-purple-300">Você não está sozinha.</h1><p class="text-purple-100 mt-2">Este é o seu espaço seguro.</p></div>
            <div class="my-8"><button class="emergency-button w-full bg-red-600 text-white font-bold text-xl py-6 rounded-full shadow-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-400 focus:ring-opacity-75">PEDIR AJUDA AGORA</button><p class="text-center text-xs text-gray-400 mt-2">Use apenas em caso de emergência real.</p></div>
            <div class="space-y-4">
                <button data-target="community-screen" class="secure-menu-button w-full bg-gray-700 p-4 rounded-lg flex items-center space-x-4 hover:bg-gray-600 transition text-left"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-300" viewBox="0 0 20 20" fill="currentColor"><path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" /><path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h7a2 2 0 002-2V9a2 2 0 00-2-2h-1z" /></svg><div><h3 class="font-semibold">Comunidade de Apoio</h3><p class="text-sm text-gray-300">Compartilhe sua história anonimamente.</p></div></button>
                <button data-target="vault-screen" class="secure-menu-button w-full bg-gray-700 p-4 rounded-lg flex items-center space-x-4 hover:bg-gray-600 transition text-left"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg><div><h3 class="font-semibold">Meu Cofre de Provas</h3><p class="text-sm text-gray-300">Guarde fotos, áudios e notas com segurança.</p></div></button>
                <button data-target="map-screen" class="secure-menu-button w-full bg-gray-700 p-4 rounded-lg flex items-center space-x-4 hover:bg-gray-600 transition text-left"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg><div><h3 class="font-semibold">Mapa de Acolhimento</h3><p class="text-sm text-gray-300">Encontre delegacias e abrigos.</p></div></button>
            </div>
            <button id="exit-secure-button" class="mt-8 w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition">Sair da Área Segura</button>
        </div>

        <!-- TELA DA COMUNIDADE -->
        <div id="community-screen" class="hidden secure-feature-screen bg-gray-800 p-4 flex flex-col">
            <div class="flex-shrink-0 flex items-center mb-4"><button class="back-to-menu-button p-2 rounded-full hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><h2 class="text-xl font-bold ml-2">Comunidade de Apoio</h2></div>
            <div class="flex-shrink-0 mb-4"><button id="generate-phrase-button" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded transition">✨ Gerar Frase de Apoio</button></div>
            <div id="posts-container" class="flex-grow overflow-y-auto space-y-3 mb-4"></div>
            <div class="flex-shrink-0"><textarea id="post-input" class="w-full bg-gray-700 rounded-lg p-2 text-white placeholder-gray-400" rows="3" placeholder="Escreva seu relato anônimo..."></textarea>
                <div class="flex space-x-2 mt-2">
                    <button id="submit-post-button" class="flex-grow bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition">Enviar</button>
                    <button id="analyze-report-button" class="flex-grow bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition">✨ Analisar Relato</button>
                </div>
            </div>
        </div>

        <!-- TELA DO COFRE DE PROVAS -->
        <div id="vault-screen" class="hidden secure-feature-screen bg-gray-800 p-4 flex flex-col">
            <div class="flex-shrink-0 flex items-center mb-4"><button class="back-to-menu-button p-2 rounded-full hover:bg-gray-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><h2 class="text-xl font-bold ml-2">Cofre de Provas</h2></div>
            <div id="vault-items-container" class="flex-grow overflow-y-auto space-y-3 mb-4"><p class="text-gray-400 text-sm">Seus itens são privados e criptografados.</p></div>
            <div class="flex-shrink-0"><input id="vault-input" class="w-full bg-gray-700 rounded-lg p-2 text-white placeholder-gray-400" placeholder="Descrição da prova (ex: 'foto do dia 10')"><button id="add-vault-item-button" class="w-full mt-2 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition">Adicionar Prova</button></div>
        </div>
        
        <!-- TELA DO MAPA -->
        <div id="map-screen" class="hidden secure-feature-screen bg-gray-800 p-4 flex flex-col">
            <div class="flex-shrink-0 flex items-center mb-4"><button class="back-to-menu-button p-2 rounded-full hover:bg-gray-700"><svg xmlns="http://www.w.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><h2 class="text-xl font-bold ml-2">Mapa de Acolhimento</h2></div>
            <div class="flex-grow bg-gray-700 rounded-lg flex items-center justify-center text-center p-4">
                <div class="text-gray-400">
                    <p class="font-bold">Simulação de Mapa</p>
                    <p class="text-sm mt-2">Numa versão real, este mapa mostraria em tempo real os centros de ajuda, delegacias e abrigos mais próximos de você.</p>
                    <img src="https://placehold.co/400x300/4a5568/a0aec0?text=Mapa+Simulado" alt="Mapa simulado com pontos de interesse" class="mt-4 rounded-lg mx-auto">
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuração do Firebase
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "...", authDomain: "...", projectId: "..." };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let userId = null;

        // Inicia a autenticação anônima
        signInAnonymously(auth).catch((error) => console.error("Erro na autenticação anônima:", error));
        
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elementos da UI ---
            const settingsButton = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const saveSettingsButton = document.getElementById('save-settings-button');
            const playerNameInput = document.getElementById('player-name');
            const errorMessage = document.getElementById('error-message');
            const gameScreen = document.getElementById('game-screen');
            const secureScreen = document.getElementById('secure-screen');
            const exitSecureButton = document.getElementById('exit-secure-button');
            const startMessage = document.getElementById('start-message');
            const scoreDisplay = document.getElementById('score');
            const geminiModal = document.getElementById('gemini-modal');
            const geminiModalTitle = document.getElementById('gemini-modal-title');
            const geminiModalBody = document.getElementById('gemini-modal-body');
            const closeGeminiModalButton = document.getElementById('close-gemini-modal');

            // --- Elementos da Tela Segura ---
            const secureMainMenu = document.getElementById('secure-main-menu');
            const secureMenuButtons = document.querySelectorAll('.secure-menu-button');
            const backToMenuButtons = document.querySelectorAll('.back-to-menu-button');
            const postsContainer = document.getElementById('posts-container');
            const postInput = document.getElementById('post-input');
            const submitPostButton = document.getElementById('submit-post-button');
            const vaultItemsContainer = document.getElementById('vault-items-container');
            const vaultInput = document.getElementById('vault-input');
            const addVaultItemButton = document.getElementById('add-vault-item-button');
            const generatePhraseButton = document.getElementById('generate-phrase-button');
            const analyzeReportButton = document.getElementById('analyze-report-button');

            // --- Lógica do Jogo (Flappy Bird) ---
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            let bird, pipes, score, gravity, lift, gameLoop;
            let gameStarted = false; let gameIsOver = false;
            function setupGame() { bird = { x: 50, y: canvas.height / 2, radius: 15, velocity: 0 }; pipes = []; score = 0; gravity = 0.4; lift = -8; gameIsOver = false; scoreDisplay.textContent = '0'; startMessage.textContent = 'Toque na tela para começar'; startMessage.style.display = 'block'; pipes.push({ x: canvas.width, y: 0, width: 50, gap: 180 }); drawInitialState(); }
            function drawInitialState() { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#588157'; ctx.fillRect(0, canvas.height - 20, canvas.width, 20); ctx.beginPath(); ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2); ctx.fillStyle = '#fca311'; ctx.fill(); ctx.closePath(); }
            function startGameLoop() { if (gameLoop) clearInterval(gameLoop); gameLoop = setInterval(updateGame, 1000 / 60); }
            function updateGame() { ctx.clearRect(0, 0, canvas.width, canvas.height); bird.velocity += gravity; bird.y += bird.velocity; if (bird.y + bird.radius > canvas.height - 20 || bird.y - bird.radius < 0) { gameOver(); return; } for (let i = pipes.length - 1; i >= 0; i--) { let p = pipes[i]; p.x -= 2; ctx.fillStyle = '#3a5a40'; ctx.fillRect(p.x, p.y, p.width, canvas.height); ctx.clearRect(p.x, p.y + (canvas.height - p.gap) / 2, p.width, p.gap); if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + p.width && (bird.y - bird.radius < (p.y + (canvas.height - p.gap) / 2) || bird.y + bird.radius > (p.y + (canvas.height - p.gap) / 2 + p.gap))) { gameOver(); return; } if (p.x + p.width < bird.x && !p.passed) { score++; scoreDisplay.textContent = score; p.passed = true; } if (p.x + p.width < 0) { pipes.splice(i, 1); } } if (pipes.length > 0 && pipes[pipes.length - 1].x < canvas.width - 200) { pipes.push({ x: canvas.width, y: 0, width: 50, gap: 180, passed: false }); } ctx.fillStyle = '#588157'; ctx.fillRect(0, canvas.height - 20, canvas.width, 20); ctx.beginPath(); ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2); ctx.fillStyle = '#fca311'; ctx.fill(); ctx.closePath(); }
            function gameOver() { clearInterval(gameLoop); gameIsOver = true; startMessage.textContent = 'Fim de Jogo! Toque para reiniciar.'; startMessage.style.display = 'block'; }
            function handleUserAction(e) { e.preventDefault(); if (!gameStarted) { gameStarted = true; startMessage.style.display = 'none'; startGameLoop(); } if (gameIsOver) { gameStarted = false; setupGame(); } else { bird.velocity = lift; } }
            canvas.addEventListener('mousedown', handleUserAction); canvas.addEventListener('touchstart', handleUserAction);
            setupGame();

            // --- Lógica do Disfarce e Tela Segura ---
            settingsButton.addEventListener('click', () => { settingsModal.style.display = 'block'; clearInterval(gameLoop); });
            closeModalButton.addEventListener('click', () => { settingsModal.style.display = 'none'; if(gameStarted && !gameIsOver) startGameLoop(); });
            saveSettingsButton.addEventListener('click', () => { if (playerNameInput.value.trim() === "Acolher123") { settingsModal.style.display = 'none'; playerNameInput.value = ''; gameScreen.classList.add('hidden'); secureScreen.classList.remove('hidden'); } else { errorMessage.classList.remove('hidden'); setTimeout(() => errorMessage.classList.add('hidden'), 3000); } });
            exitSecureButton.addEventListener('click', () => { secureScreen.classList.add('hidden'); gameScreen.classList.remove('hidden'); gameStarted = false; setupGame(); });
            window.onclick = (event) => { if (event.target == settingsModal) { settingsModal.style.display = "none"; if(gameStarted && !gameIsOver) startGameLoop(); } }

            // --- Navegação na Tela Segura ---
            secureMenuButtons.forEach(button => { button.addEventListener('click', () => { const targetScreenId = button.dataset.target; const targetScreen = document.getElementById(targetScreenId); if (targetScreen) { secureMainMenu.classList.add('hidden'); targetScreen.classList.remove('hidden'); } }); });
            backToMenuButtons.forEach(button => { button.addEventListener('click', () => { button.closest('.secure-feature-screen').classList.add('hidden'); secureMainMenu.classList.remove('hidden'); }); });
            
            // --- Funcionalidades com Gemini API ---
            async function callGeminiAPI(prompt, systemPrompt) {
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                let retries = 3;
                let delay = 1000;

                while (retries > 0) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        return result.candidates?.[0]?.content?.parts?.[0]?.text || "Não foi possível gerar uma resposta. Tente novamente.";
                    } catch (error) {
                        console.error("Erro na API do Gemini:", error);
                        retries--;
                        if (retries === 0) {
                            return "Ocorreu um erro ao se comunicar com a IA. Por favor, verifique sua conexão e tente novamente mais tarde.";
                        }
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Exponential backoff
                    }
                }
            }
            
            function showGeminiModal(title, body) {
                geminiModalTitle.textContent = title;
                geminiModalBody.textContent = body;
                geminiModal.style.display = 'block';
            }

            closeGeminiModalButton.addEventListener('click', () => {
                geminiModal.style.display = 'none';
            });

            generatePhraseButton.addEventListener('click', async () => {
                showGeminiModal("Gerando Frase...", "Aguarde um momento...");
                const systemPrompt = "Aja como uma conselheira empática e solidária. Gere uma frase curta, poderosa e encorajadora para uma mulher em situação de vulnerabilidade. A frase deve inspirar força, esperança e a sensação de que ela não está sozinha. Use uma linguagem acolhedora e direta.";
                const prompt = "Gere uma frase de apoio.";
                const response = await callGeminiAPI(prompt, systemPrompt);
                showGeminiModal("Frase de Apoio ✨", response);
            });

            analyzeReportButton.addEventListener('click', async () => {
                const reportText = postInput.value.trim();
                if (!reportText) {
                    alert("Por favor, escreva seu relato antes de analisar.");
                    return;
                }
                showGeminiModal("Analisando Relato...", "Aguarde enquanto a IA processa seu texto...");
                const systemPrompt = "Você é uma assistente virtual especializada em dar apoio a mulheres em situação de violência doméstica. Sua função é analisar o relato de uma usuária de forma anônima e segura. Você NUNCA deve dar conselhos legais ou substituir um profissional. Sua resposta deve ser estruturada em 3 partes: 1. Validação: Comece validando os sentimentos da usuária ('Sinto muito que você esteja passando por isso...', 'É preciso muita coragem para falar sobre isso.'). 2. Organização: Identifique e resuma os pontos chave do relato em tópicos curtos para ajudar a usuária a organizar seus pensamentos. 3. Próximos Passos Sugeridos: De forma GERAL e SEGURA, sugira tipos de ajuda que ela pode procurar, como 'Conversar com alguém de confiança', 'Buscar um centro de referência para mulheres na sua cidade' ou 'Documentar situações futuras em um local seguro'. NUNCA sugira ações que possam colocá-la em risco. Mantenha a resposta clara, objetiva e empoderadora.";
                const prompt = `Analise o seguinte relato: "${reportText}"`;
                const response = await callGeminiAPI(prompt, systemPrompt);
                showGeminiModal("Análise do Relato ✨", response);
            });

            // --- Funcionalidades com Firebase ---
            onAuthStateChanged(auth, (user) => { if (user) { userId = user.uid; setupRealtimeListeners(); } else { userId = null; } });
            function setupRealtimeListeners() {
                if (!userId) return;
                const postsCollection = collection(db, `artifacts/${appId}/public/data/posts`);
                const qPosts = query(postsCollection);
                onSnapshot(qPosts, (querySnapshot) => {
                    postsContainer.innerHTML = '';
                    const posts = [];
                    querySnapshot.forEach((doc) => posts.push({ id: doc.id, ...doc.data() }));
                    posts.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    posts.forEach(post => { const postElement = document.createElement('div'); postElement.className = 'bg-gray-700 p-3 rounded-lg'; const date = post.createdAt ? new Date(post.createdAt.seconds * 1000).toLocaleString('pt-BR') : 'agora'; postElement.innerHTML = `<p class="text-white">${post.text}</p><p class="text-xs text-gray-400 mt-2 text-right">${date}</p>`; postsContainer.appendChild(postElement); });
                });
                const vaultCollection = collection(db, `artifacts/${appId}/users/${userId}/vault`);
                const qVault = query(vaultCollection);
                onSnapshot(qVault, (querySnapshot) => {
                    vaultItemsContainer.innerHTML = '<p class="text-gray-400 text-sm">Seus itens são privados e criptografados.</p>';
                    const items = [];
                    querySnapshot.forEach((doc) => items.push({ id: doc.id, ...doc.data() }));
                    items.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    items.forEach(item => { const itemElement = document.createElement('div'); itemElement.className = 'bg-gray-700 p-3 rounded-lg'; const date = item.createdAt ? new Date(item.createdAt.seconds * 1000).toLocaleString('pt-BR') : 'agora'; itemElement.innerHTML = `<p class="text-white">${item.description}</p><p class="text-xs text-gray-400 mt-2 text-right">${date}</p>`; vaultItemsContainer.appendChild(itemElement); });
                });
            }
            submitPostButton.addEventListener('click', async () => { const text = postInput.value.trim(); if (text) { try { await addDoc(collection(db, `artifacts/${appId}/public/data/posts`), { text: text, createdAt: serverTimestamp() }); postInput.value = ''; } catch (e) { console.error("Erro ao adicionar post: ", e); } } });
            addVaultItemButton.addEventListener('click', async () => { const description = vaultInput.value.trim(); if (description && userId) { try { await addDoc(collection(db, `artifacts/${appId}/users/${userId}/vault`), { description: description, createdAt: serverTimestamp() }); vaultInput.value = ''; } catch (e) { console.error("Erro ao adicionar item ao cofre: ", e); } } });
        });
    </script>
</body>
</html>
